<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600243 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1088"/>

<div>
<span><div><span style="font-size: 14pt;">一  基于EventBus 3.0以后的版本 主要包括</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>   1.Subscribe注解</div><div>   <span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(102, 102, 102) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-style: italic;">@Subscribe</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">(</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(0, 45, 122) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">threadMode</span> <span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(0, 111, 224) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">=</span> <span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(0, 45, 122) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">ThreadMode</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">.</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(0, 45, 122) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">MAIN</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">)</span></div><div style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; margin: 0px; outline: 0px; padding: 0px 5px; background: 0px center rgb(248, 248, 255); text-align: left; line-height: inherit !important; color: rgb(0, 0, 0); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(128, 0, 128) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public</span> <span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(128, 0, 128) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">void</span> <span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: teal !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">onMessageEvent</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">(</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: teal !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">MessageEvent</span> <span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(0, 45, 122) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">event</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">)</span> <span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">{</span></div><div style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; margin: 0px; outline: 0px; padding: 0px 5px; background: 0px center rgb(248, 248, 255); text-align: left; line-height: inherit !important; color: rgb(0, 0, 0); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(0, 111, 224) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">    </span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(0, 45, 122) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Toast</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">.</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: teal !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">makeText</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">(</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: teal !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">getActivity</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">(</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">)</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">,</span> <span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(0, 45, 122) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">event</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">.</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(0, 45, 122) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">message</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">,</span> <span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(0, 45, 122) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Toast</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">.</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(0, 45, 122) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">LENGTH_SHORT</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">)</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">.</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: teal !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">show</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">(</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">)</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">;</span></div><div><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: inherit !important; outline: 0px; background: 0px center rgb(248, 248, 255); line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">}</span></div><div>   2.注册事件的订阅方法</div><div><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(0, 45, 122) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">EventBus</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">.</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: teal !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">getDefault</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">(</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">)</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">.</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: teal !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">register</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">(</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(0, 0, 0); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">this</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">)</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">;</span></div><div>   3.取消注册方法</div><div><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(0, 111, 224) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);"> </span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(0, 45, 122) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">EventBus</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">.</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: teal !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">getDefault</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">(</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">)</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">.</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: teal !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">unregister</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">(</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(0, 0, 0); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">this</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">)</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">;</span></div><div>   4.发送事件</div><div>EventBus.getDefault().post(new MessageEvent(&quot;Hello everyone!&quot;));</div><div>   5.事件的处理</div><div>   6.粘性事件</div></div><div><br/></div><div><br/></div><div><span style="font-size: 14pt;">二 </span><span style="border: 0px; outline: 0px; background: 0px center rgb(248, 248, 255); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt; color: rgb(102, 102, 102); font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal;">Subscribe 注解</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><br/></div><div><span style="color: #bbb529; font-family: Monaco; font-size: 9pt;">@Documented</span></div><div><span style="color: #bbb529; font-family: Monaco; font-size: 9pt;">@Retention</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">(RetentionPolicy.</span><span style="color: #9876aa; font-style: italic; font-family: Monaco; font-size: 9pt;">RUNTIME</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">) </span></div><div><span style="color: #bbb529; font-family: Monaco; font-size: 9pt;">@Target</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">({ElementType.</span><span style="color: #9876aa; font-style: italic; font-family: Monaco; font-size: 9pt;">METHOD</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">})</span></div><div><span style="color: #cc7832; font-family: Monaco; font-size: 9pt;">public</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@</span><span style="color: #cc7832; font-family: Monaco; font-size: 9pt;">interface</span> <span style="color: #bbb529; font-family: Monaco; font-size: 9pt;">Subscribe</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><br/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">ThreadMode</span> <span style="color: #ffc66d; font-family: Monaco; font-size: 9pt;">threadMode</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">()</span> <span style="color: #cc7832; font-family: Monaco; font-size: 9pt;">default</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">ThreadMode.</span><span style="color: #9876aa; font-style: italic; font-family: Monaco; font-size: 9pt;">POSTING</span><span style="color: #cc7832; font-family: Monaco; font-size: 9pt;">;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">/**</span></div><div><span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">*控制粘性事件的 如果为true  支持粘性事件,就会调用<span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">postSticky 到订阅事件中  默认为fasle</span></span></div><div><span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">*/</span></div><div><span style="color: #cc7832; font-family: Monaco; font-size: 9pt;">boolean</span> <span style="color: #ffc66d; font-family: Monaco; font-size: 9pt;">sticky</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">()</span> <span style="color: #cc7832; font-family: Monaco; font-size: 9pt;">default false;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">/** </span></div><div><span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">*优先级</span></div><div><span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">*/</span></div><div><span style="color: #cc7832; font-family: Monaco; font-size: 9pt;">int</span> <span style="color: #ffc66d; font-family: Monaco; font-size: 9pt;">priority</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">()</span> <span style="color: #cc7832; font-family: Monaco; font-size: 9pt;">default</span> <span style="color: #6897bb; font-family: Monaco; font-size: 9pt;">0</span><span style="color: #cc7832; font-family: Monaco; font-size: 9pt;">;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div>这几个是元注解  （用来标记注解的注解）</div><div><span style="font-size: 9pt; color: rgb(187, 181, 41); font-family: Monaco;">@Documented</span></div><div><font style="font-size: 10pt;"><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(79, 79, 79); font-family: mceinline; font-variant-caps: normal; font-variant-ligatures: normal;">Documented注解表明制作javadoc时，是否将注解信息加入文档。如果注解在声明时使用了@Documented，则在制作javadoc时注解信息会加入javado</span></font></div><div><span style="font-size: 9pt; color: rgb(187, 181, 41); font-family: Monaco;">@Retention</span><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">(RetentionPolicy.</span><span style="font-size: 9pt; color: rgb(152, 118, 170); font-family: Monaco; font-style: italic;">RUNTIME</span><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">) </span></div><div><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">注解的保留位置　</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color: #cc7832; font-family: Monaco; font-size: 9pt;">public enum</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">RetentionPolicy {</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">//保留到项目里里面</span></div><div><span style="color: #9876aa; font-style: italic; font-family: Monaco; font-size: 9pt;">SOURCE</span><span style="color: #cc7832; font-family: Monaco; font-size: 9pt;">,</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">//保留到java 编译之后的class类里面</span></div><div><span style="color: #9876aa; font-style: italic; font-family: Monaco; font-size: 9pt;">CLASS</span><span style="color: #cc7832; font-family: Monaco; font-size: 9pt;">,</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-size: 9pt; color: rgb(98, 151, 85); font-family: Monaco;"><i>//保存到运行时</i></span></div><div><span style="color: #9876aa; font-style: italic; font-family: Monaco; font-size: 9pt;">RUNTIME</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><span style="font-size: 9pt; color: rgb(187, 181, 41); font-family: Monaco;">@Target</span><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">({ElementType.</span><span style="font-size: 9pt; color: rgb(152, 118, 170); font-family: Monaco; font-style: italic;">METHOD</span><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">})</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">注解的使用方式，就是这个注解只能放在特定的位置</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 9pt;"><span style="color: rgb(204, 120, 50); font-family: Monaco;">public enum</span> <span style="font-family: Monaco; color: rgb(51, 51, 51);">ElementType {</span></font></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">/** </font></span></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">*   <span style="color: rgb(0, 128, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-style: italic;">接口、类、枚举、注解</span></font></span></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;"> */</font></span></div><div><font style="font-size: 9pt;"><span style="color: rgb(152, 118, 170); font-style: italic; font-family: Monaco;">TYPE</span><span style="color: rgb(204, 120, 50); font-family: Monaco;">,</span></font></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">/** </font></span></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">* <span style="color: rgb(0, 128, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-style: italic;">字段、枚举的常量</span></font></span></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">*/</font></span></div><div><font style="font-size: 9pt;"><span style="color: rgb(152, 118, 170); font-style: italic; font-family: Monaco;">FIELD</span><span style="color: rgb(204, 120, 50); font-family: Monaco;">,</span></font></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">/** </font></span></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">* <span style="color: rgb(0, 128, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-style: italic;">方法</span></font></span></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">*/</font></span></div><div><font style="font-size: 9pt;"><span style="color: rgb(152, 118, 170); font-style: italic; font-family: Monaco;">METHOD</span><span style="color: rgb(204, 120, 50); font-family: Monaco;">,</span></font></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">/** </font></span></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">* <span style="color: rgb(0, 128, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-style: italic;">方法参数</span></font></span></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;"> */</font></span></div><div><font style="font-size: 9pt;"><span style="color: rgb(152, 118, 170); font-style: italic; font-family: Monaco;">PARAMETER</span><span style="color: rgb(204, 120, 50); font-family: Monaco;">,</span></font></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">/** </font></span></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">* <span style="color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-style: italic;"> </span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 128, 0); font-style: italic;">构造函数</span></font></span></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">*/</font></span></div><div><font style="font-size: 9pt;"><span style="color: rgb(152, 118, 170); font-style: italic; font-family: Monaco;">CONSTRUCTOR</span><span style="color: rgb(204, 120, 50); font-family: Monaco;">,</span></font></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">/** </font></span></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">* <span style="color: rgb(0, 128, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-style: italic;">局部变量</span></font></span></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">*/</font></span></div><div><font style="font-size: 9pt;"><span style="color: rgb(152, 118, 170); font-style: italic; font-family: Monaco;">LOCAL_VARIABLE</span><span style="color: rgb(204, 120, 50); font-family: Monaco;">,</span></font></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">/** </font></span></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">* <span style="color: rgb(0, 128, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-style: italic;">注解</span></font></span></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">*/</font></span></div><div><font style="font-size: 9pt;"><span style="color: rgb(152, 118, 170); font-style: italic; font-family: Monaco;">ANNOTATION_TYPE</span><span style="color: rgb(204, 120, 50); font-family: Monaco;">,</span></font></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">/** </font></span></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">* <span style="font-family: Helvetica, Tahoma, Arial, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(0, 128, 0); font-style: italic;">包</span><span style="color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-style: italic;"> </span></font></span></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;"> */</font></span></div><div><font style="font-size: 9pt;"><span style="color: rgb(152, 118, 170); font-style: italic; font-family: Monaco;">PACKAGE</span><span style="color: rgb(204, 120, 50); font-family: Monaco;">,</span></font></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">/**</font></span></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">* Type parameter declaration</font></span></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">*</font></span></div><div><font style="font-size: 9pt;"><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;">*</span> <span style="color: rgb(98, 151, 85); font-weight: bold; font-style: italic; font-family: Monaco;">@since</span> <span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;">1.8</span></font></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">*/</font></span></div><div><font style="font-size: 9pt;"><span style="color: rgb(152, 118, 170); font-style: italic; font-family: Monaco;">TYPE_PARAMETER</span><span style="color: rgb(204, 120, 50); font-family: Monaco;">,</span></font></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">/**</font></span></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">* Use of a type</font></span></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">*</font></span></div><div><font style="font-size: 9pt;"><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;">*</span> <span style="color: rgb(98, 151, 85); font-weight: bold; font-style: italic; font-family: Monaco;">@since</span> <span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;">1.8</span></font></div><div><span style="color: rgb(98, 151, 85); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">*/</font></span></div><div><span style="color: rgb(152, 118, 170); font-style: italic; font-family: Monaco;"><font style="font-size: 9pt;">TYPE_USE</font></span></div><div><span style="font-family: Monaco; color: rgb(51, 51, 51);"><font style="font-size: 9pt;">}</font></span></div></div><div>实际上还有一个注解  <span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">@Inherited  ： <span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">子类可以继承父类中的该注解  这是jdk1.5之后提供的方法</span></span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">ThreadMode</span> <span style="color: #ffc66d; font-family: Monaco; font-size: 9pt;">threadMode</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">()</span> <span style="color: #cc7832; font-family: Monaco; font-size: 9pt;">default</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">ThreadMode.</span><span style="color: #9876aa; font-style: italic; font-family: Monaco; font-size: 9pt;">POSTING</span><span style="color: #cc7832; font-family: Monaco; font-size: 9pt;">;</span></div></div><div><br/></div><div><span style="font-size: 14px; font-family: Helvetica, Tahoma, Arial, sans-serif;">这个是判断你想要的回调方法在哪个线程,就是在什么线程处理订阅的方法</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font face="Helvetica, Tahoma, Arial, sans-serif"><span style="color: #cc7832; font-family: Monaco; font-size: 9pt;">public enum</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">ThreadMode {</span></font></div><div><font face="Helvetica, Tahoma, Arial, sans-serif"><span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">/**</span></font></div><div><font face="Helvetica, Tahoma, Arial, sans-serif"><span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">* post方法跑在那个方法，回调就跑在那个方法  默认的线程，避免切换线程，效率高点</span></font></div><div><font face="Helvetica, Tahoma, Arial, sans-serif"><span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">*/</span></font></div><div><font face="Helvetica, Tahoma, Arial, sans-serif"><span style="color: #9876aa; font-style: italic; font-family: Monaco; font-size: 9pt;">POSTING</span><span style="color: #cc7832; font-family: Monaco; font-size: 9pt;">,</span></font></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><font face="Helvetica, Tahoma, Arial, sans-serif"><span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">/**</span></font></div><div><font face="Helvetica, Tahoma, Arial, sans-serif"><span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">*主线程发送事件，则直接在主线程中处理，子线程发送事件，<span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">通过handler切换到主线程</span></span></font></div><div><span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">*</span></div><div><span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">* 回调在主线程  </span></div><div><span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">*/</span></div><div><span style="color: #9876aa; font-style: italic; font-family: Monaco; font-size: 9pt;">MAIN</span><span style="color: #cc7832; font-family: Monaco; font-size: 9pt;">,</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">/**</span></div><div><span style="font-style: italic; font-family: Monaco;"><span style="color: rgb(98, 151, 85); font-size: 9pt;">* y有序的主线程  </span><span style="color: rgb(98, 151, 85); font-size: 9pt; font-style: italic; font-family: Monaco;"> </span></span></div><div><span style="font-style: italic; font-family: Monaco;"><span style="color: rgb(98, 151, 85); font-size: 9pt; font-style: italic; font-family: Monaco;">*<span style="font-style: italic; font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: #328712; font-size: 9pt;">无论在那个线程发送事件，都先将事件入队列，然后通过 Handler 切换到主线程，依次处理事件</span></span></span></div><div><span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">*/</span></div><div><span style="color: #9876aa; font-style: italic; font-family: Monaco; font-size: 9pt;">MAIN_ORDERED</span><span style="color: #cc7832; font-family: Monaco; font-size: 9pt;">,</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">/**</span></div><div><span style="font-style: italic; font-family: Monaco;"><font color="#629755" style="font-size: 9pt;">* </font> <span style="font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-style: italic;"><font color="#328712" style="font-size: 9pt;">如果在主线程发送事件，则先将事件入队列，然后通过线程池依次处理事件；如果在子线程发送事件，则直接在发送事件的线程处理事件</font></span></span></div><div><span style="font-style: italic; font-family: Monaco;"><span style="font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-style: italic;"><font color="#328712" style="font-size: 9pt;">*<span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">回调在子线程</span></font></span></span></div><div><span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">*/</span></div><div><span style="color: #9876aa; font-style: italic; font-family: Monaco; font-size: 9pt;">BACKGROUND</span><span style="color: #cc7832; font-family: Monaco; font-size: 9pt;">,</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">/**</span></div><div><span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">* 回调在子线程，并重新创建一个线程  通过线程池处理</span></div><div><span style="color: #629755; font-style: italic; font-family: Monaco; font-size: 9pt;">*/</span></div><div><span style="color: #9876aa; font-style: italic; font-family: Monaco; font-size: 9pt;">ASYNC</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div><span style="font-size: 14pt;">三 注册事件的订阅方法</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(0, 45, 122) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">EventBus</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">.</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: teal !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">getDefault</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">(</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">)</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">.</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: teal !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">register</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">(</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(0, 0, 0); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">this</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">)</span><span style="border: 0px; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-size: 13px; outline: 0px; line-height: inherit !important; color: rgb(51, 51, 51) !important; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255);">;</span></div></div><div><br/></div><div><font style="font-size: 11pt;"><span style="border: 0px; outline: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255); font-size: 11pt; color: teal; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">getDefault()</span><span style="border: 0px; outline: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255); font-size: 11pt; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">是一个单利方法 ，保证并返回一个Eventbus对象</span></font></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><br style="font-family: Consolas;"/></div><div><span style="font-family: Consolas;"><span style="font-family: Consolas;">/**</span></span></div><div><span style="font-family: Consolas;">* Convenience singleton for apps using a process-wide EventBus instance.</span></div><div><span style="font-family: Consolas;">* &lt;p&gt;</span></div><div><span style="font-family: Consolas;">* 单利 创建对象</span></div><div><span style="font-family: Consolas;">*/</span></div><div><span style="font-family: Consolas;">public static EventBus getDefault() {</span></div><div><span style="font-family: Consolas;">    EventBus instance = defaultInstance;</span></div><div><span style="font-family: Consolas;">    if (instance == null) {</span></div><div><span style="font-family: Consolas;">        synchronized (EventBus.class) {</span></div><div><span style="font-family: Consolas;">            instance = EventBus.defaultInstance;</span></div><div><span style="font-family: Consolas;">            if (instance == null) {</span></div><div><span style="font-family: Consolas;">                instance = EventBus.defaultInstance = <font color="#FF0000">new EventBus();</font></span></div><div><span style="font-family: Consolas;">            }</span></div><div><span style="font-family: Consolas;">        }</span></div><div><span style="font-family: Consolas;">    }</span></div><div><span style="font-family: Consolas;">    return instance;</span></div><div><span style="font-family: Consolas;">}</span></div></div><div><br/></div><div><span style="font-size: 14.6667px; font-family: 宋体;">这里的<span style="font-size: 11pt; font-family: Consolas;">new EventBus(); 是对相关属性的初始化</span></span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">public EventBus() {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    this(DEFAULT_BUILDER);</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">}</font></span></div><div><br/></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">EventBus(EventBusBuilder builder) {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    logger = builder.getLogger();</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    subscriptionsByEventType = new HashMap&lt;&gt;();</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    typesBySubscriber = new HashMap&lt;&gt;();</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    stickyEvents = new ConcurrentHashMap&lt;&gt;();</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    mainThreadSupport = builder.getMainThreadSupport();</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    mainThreadPoster = mainThreadSupport != null ? mainThreadSupport.createPoster(this) : null;</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    backgroundPoster = new BackgroundPoster(this);</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    asyncPoster = new AsyncPoster(this);</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    indexCount = builder.subscriberInfoIndexes != null ? builder.subscriberInfoIndexes.size() : 0;</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    subscriberMethodFinder = new SubscriberMethodFinder(builder.subscriberInfoIndexes,</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">            builder.strictMethodVerification, builder.ignoreGeneratedIndex);</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    logSubscriberExceptions = builder.logSubscriberExceptions;</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    logNoSubscriberMessages = builder.logNoSubscriberMessages;</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    sendSubscriberExceptionEvent = builder.sendSubscriberExceptionEvent;</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    sendNoSubscriberEvent = builder.sendNoSubscriberEvent;</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    throwSubscriberException = builder.throwSubscriberException;</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    eventInheritance = builder.eventInheritance;</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    executorService = builder.executorService;</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">}</font></span></div></div><div><span style="font-size: 11pt; font-family: Consolas;">DEFAULT_BUILDER 就是一个默认的<span style="font-size: 11pt; font-family: Consolas;">EventBusBuilder</span></span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 9pt; font-family: Consolas; color: rgb(0, 0, 0);">private static final EventBusBuilder DEFAULT_BUILDER = new EventBusBuilder();</font></div></div><div><br/></div><div><span style="font-size: 11pt;">可以通过</span><span style="font-size: 11pt; color: rgb(0, 0, 0);">EventBusBuilder 改变EventBus的属性</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt;">EventBus.builder() .eventInheritance(false) .logSubscriberExceptions(false) .build() .register(this);</span></div></div><div><br/></div><div><span style="font-size: 11pt;">然后就是注册了</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="color: rgb(0, 0, 0);">public void register(Object subscriber) {</font></div><div><font color="#000000">    Class&lt;?&gt; subscriberClass = subscriber.getClass();</font></div><div><font color="#000000">    // 获取订阅者的订阅方法并用List封装</font></div><div><font style="color: rgb(0, 0, 0);">    List&lt;SubscriberMethod&gt; subscriberMethods =</font> <font color="#FF0000">subscriberMethodFinder.findSubscriberMethods(subscriberClass);</font></div><div><font color="#000000">    synchronized (this) {</font></div><div><font color="#000000">        // 逐个订阅</font></div><div><font color="#000000">        for (SubscriberMethod subscriberMethod : subscriberMethods) {</font></div><div><font style="color: rgb(0, 0, 0);">           </font><font color="#FF0000"> subscribe(subscriber, subscriberMethod);</font></div><div><font color="#000000">        }</font></div><div><font color="#000000">    }</font></div><div><font color="#000000">}</font></div></div><div><br/></div><div><span style="font-size: 11pt;">冲代码中可以看出，</span><span style="font-size: 11pt; color: rgb(0, 0, 0);">register()分为查找和注册  分别是<span style="font-size: 11pt; color: rgb(0, 0, 0);">findSubscriberMethods（） 和<span style="font-size: 11pt; color: rgb(0, 0, 0);">subscribe（）</span></span></span></div><div><span style="font-size: 11pt; color: rgb(0, 0, 0);">findSubscriberMethods（）</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>List&lt;SubscriberMethod&gt; findSubscriberMethods(Class&lt;?&gt; subscriberClass) {</div><div>    //METHOD_CACHE 是一个map集合，已订阅者的Class对象为key,订阅者的订阅的方法为value  包括 优先级，粘性事件，订阅方法，事件类型 ，线程池</div><div>    List&lt;SubscriberMethod&gt; subscriberMethods = METHOD_CACHE.get(subscriberClass);</div><div>    //缓存中已经注册过了，就直接缓存</div><div>    if (subscriberMethods != null) {</div><div>        return subscriberMethods;</div><div>    }</div><div>    //没有从缓存中获取注册信息，就要 添加缓存</div><div>    // SubscriberMethodFinder通过EventBusBuilder的同名属性赋值的 ，builder.ignoreGeneratedIndex 这个值默认是false</div><div>    if (ignoreGeneratedIndex) {</div><div>        //通过反射获取</div><div>      <font color="#FF0000">  subscriberMethods = findUsingReflection(subscriberClass);</font></div><div>    } else {</div><div>        //使用SubscriberIndex方式获取</div><div>       <font color="#FF0000"> subscriberMethods = findUsingInfo(subscriberClass);</font></div><div>    }</div><div>    if (subscriberMethods.isEmpty()) {</div><div>        throw new EventBusException(&quot;Subscriber &quot; + subscriberClass</div><div>                + &quot; and its super classes have no public methods with the @Subscribe annotation&quot;);</div><div>    } else {</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">//将注册信息存到缓存中</span></div><div>        METHOD_CACHE.put(subscriberClass, subscriberMethods);</div><div>        return subscriberMethods;</div><div>    }</div><div>}</div></div><div><br/></div><div>现从缓存中查找，如果查找到直接返回，如果没有，再进行查找 ，并将注册信息放入到缓存中</div><div>因为 ignoreGeneratedIndex 这个值默认为false,所以默认执行findUsingInfo(subscriberClass);方法</div><div>findUsingInfo（）</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#000000">private List&lt;SubscriberMethod&gt; findUsingInfo(Class&lt;?&gt; subscriberClass) {</font></div><div><font color="#000000">    //获取FindState对象</font></div><div><font color="#000000">    FindState findState = prepareFindState();</font></div><div><font color="#000000">    // findState与subscriberClass关联</font></div><div><font color="#000000">    findState.initForSubscriber(subscriberClass);</font></div><div><font color="#000000">    while (findState.clazz != null) {</font></div><div><font color="#000000">        // 获取当前clazz对应的SubscriberInfo</font></div><div><font color="#000000">        findState.subscriberInfo = getSubscriberInfo(findState);</font></div><div><font color="#000000">        if (findState.subscriberInfo != null) {</font></div><div><font color="#000000">            SubscriberMethod[] array = findState.subscriberInfo.getSubscriberMethods();</font></div><div><font color="#000000">            for (SubscriberMethod subscriberMethod : array) {</font></div><div><font color="#000000">                if (findState.checkAdd(subscriberMethod.method, subscriberMethod.eventType)) {</font></div><div><font color="#000000">                    findState.subscriberMethods.add(subscriberMethod);</font></div><div><font color="#000000">                }</font></div><div><font color="#000000">            }</font></div><div><font color="#000000">        } else {</font></div><div><font style="color: rgb(0, 0, 0);">        </font><font color="#FF0000">    findUsingReflectionInSingleClass(findState);</font></div><div><font color="#000000">        }</font></div><div><font color="#000000">        findState.moveToSuperclass();</font></div><div><font color="#000000">    }</font></div><div><font color="#000000">    return getMethodsAndRelease(findState);</font></div><div><font color="#000000">}</font></div></div><div><span style="word-break: break-word; background-color: rgb(255, 245, 245); border-radius: 2px; overflow-x: auto; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="background-color: rgb(255, 245, 245); font-size: 11pt; color: rgb(255, 80, 44); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">Fi</span></span><span style="word-break: break-word; background-color: rgb(255, 245, 245); border-radius: 2px; overflow-x: auto; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="background-color: rgb(255, 245, 245); font-size: 11pt; color: rgb(255, 80, 44); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">ndState</span></span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">类，</span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">它是</span></span><span style="font-size: 11pt; word-break: break-word; background-color: rgb(255, 245, 245); border-radius: 2px; overflow-x: auto; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 80, 44); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">SubscriberMethodFinder</span><span style="font-size: 11pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">的内部类</span><span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">，用来辅助查找订阅事件的方法  查找的方法 <span style="font-size: 11pt; color: rgb(0, 0, 0); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">findUsingReflectionInSingleClass（） 主要通过反射查找订阅事件的</span></span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#000000" style="font-size: 9pt;">private void findUsingReflectionInSingleClass(FindState findState) {</font></div><div><font color="#000000" style="font-size: 9pt;">    Method[] methods;</font></div><div><font color="#000000" style="font-size: 9pt;">    try {</font></div><div><font color="#000000" style="font-size: 9pt;">        // This is faster than getMethods, especially when subscribers are fat classes like Activities</font></div><div><font color="#000000" style="font-size: 9pt;">        //获取该订阅者所有的方法，比jdk 的getMethods更快</font></div><div><font color="#000000" style="font-size: 9pt;">        methods = findState.clazz.getDeclaredMethods();</font></div><div><font color="#000000" style="font-size: 9pt;">    } catch (Throwable th) {</font></div><div><font color="#000000" style="font-size: 9pt;">        // Workaround for java.lang.NoClassDefFoundError, see <a href="https://github.com/greenrobot/EventBus/issues/149" style="color: rgb(0, 0, 0);">https://github.com/greenrobot/EventBus/issues/149</a></font></div><div><font color="#000000" style="font-size: 9pt;">        methods = findState.clazz.getMethods();</font></div><div><font color="#000000" style="font-size: 9pt;">        findState.skipSuperClasses = true;</font></div><div><font color="#000000" style="font-size: 9pt;">    }</font></div><div><font color="#000000" style="font-size: 9pt;">    for (Method method : methods) {</font></div><div><font color="#000000" style="font-size: 9pt;">        //获取该方法的修饰字段，如public、private、static、final、synchronized、abstract等</font></div><div><font color="#000000" style="font-size: 9pt;">        int modifiers = method.getModifiers();</font></div><div><font color="#000000" style="font-size: 9pt;">        //修饰的方法只能是public,static否则会抛出异常 所以当我们在订阅类中，使用的不是public 的时候，就收到信息</font></div><div><font color="#000000" style="font-size: 9pt;">        if ((modifiers &amp; Modifier.PUBLIC) != 0 &amp;&amp; (modifiers &amp; MODIFIERS_IGNORE) == 0) {</font></div><div><font color="#000000" style="font-size: 9pt;">            //获取方法参数</font></div><div><font color="#000000" style="font-size: 9pt;">            Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();</font></div><div><font color="#000000" style="font-size: 9pt;">            //该参数的长度只能是一个，如果是多个就是抛出异常</font></div><div><font color="#000000" style="font-size: 9pt;">            if (parameterTypes.length == 1) {</font></div><div><font color="#000000" style="font-size: 9pt;">                //判断该方法的是否存在Subscribe注解</font></div><div><font color="#000000" style="font-size: 9pt;">                Subscribe subscribeAnnotation = method.getAnnotation(Subscribe.class);</font></div><div><font color="#000000" style="font-size: 9pt;">                if (subscribeAnnotation != null) {</font></div><div><font color="#000000" style="font-size: 9pt;">                    //因为该参数就只有一个，所以直接写成[0]  得到该参数的类型</font></div><div><font color="#000000" style="font-size: 9pt;">                    Class&lt;?&gt; eventType = parameterTypes[0];</font></div><div><font color="#000000" style="font-size: 9pt;">                    //检查eventType决定是否订阅</font></div><div><font color="#000000" style="font-size: 9pt;">                    if (findState.checkAdd(method, eventType)) {</font></div><div><font color="#000000" style="font-size: 9pt;">                        //获取当前线程</font></div><div><font color="#000000" style="font-size: 9pt;">                        ThreadMode threadMode = subscribeAnnotation.threadMode();</font></div><div><font color="#000000" style="font-size: 9pt;">                        //将订阅方法存进list</font></div><div><font color="#000000" style="font-size: 9pt;">                        findState.subscriberMethods.add(new SubscriberMethod(method, eventType, threadMode,</font></div><div><font color="#000000" style="font-size: 9pt;">                                subscribeAnnotation.priority(), subscribeAnnotation.sticky()));</font></div><div><font color="#000000" style="font-size: 9pt;">                    }</font></div><div><font color="#000000" style="font-size: 9pt;">                }</font></div><div><font color="#000000" style="font-size: 9pt;">            } else if (strictMethodVerification &amp;&amp; method.isAnnotationPresent(Subscribe.class)) {</font></div><div><font color="#000000" style="font-size: 9pt;">                String methodName = method.getDeclaringClass().getName() + &quot;.&quot; + method.getName();</font></div><div><font color="#000000" style="font-size: 9pt;">                throw new EventBusException(&quot;@Subscribe method &quot; + methodName +</font></div><div><font color="#000000" style="font-size: 9pt;">                        &quot;must have exactly 1 parameter but has &quot; + parameterTypes.length);</font></div><div><font color="#000000" style="font-size: 9pt;">            }</font></div><div><font color="#000000" style="font-size: 9pt;">        } else if (strictMethodVerification &amp;&amp; method.isAnnotationPresent(Subscribe.class)) {</font></div><div><font color="#000000" style="font-size: 9pt;">            String methodName = method.getDeclaringClass().getName() + &quot;.&quot; + method.getName();</font></div><div><font color="#000000" style="font-size: 9pt;">            throw new EventBusException(methodName +</font></div><div><font color="#000000" style="font-size: 9pt;">                    &quot; is a illegal @Subscribe method: must be public, non-static, and non-abstract&quot;);</font></div><div><font color="#000000" style="font-size: 9pt;">        }</font></div><div><font color="#000000" style="font-size: 9pt;">    }</font></div><div><font color="#000000" style="font-size: 9pt;">}</font></div></div><div><br/></div><div><br/></div><div><span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">到此</span><span style="font-size: 0.87em; word-break: break-word; background-color: rgb(255, 245, 245); border-radius: 2px; overflow-x: auto; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 80, 44); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">register()</span><span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">方法中</span><span style="font-size: 0.87em; word-break: break-word; background-color: rgb(255, 245, 245); border-radius: 2px; overflow-x: auto; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 80, 44); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">findSubscriberMethods()</span><span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">流程就分析完了，我们已经找到了当前注册类及其父类中订阅事件的方法的集合。接下来分析具体的注册流程，即</span><span style="font-size: 0.87em; word-break: break-word; background-color: rgb(255, 245, 245); border-radius: 2px; overflow-x: auto; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 80, 44); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">register()</span><span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">中的</span><span style="font-size: 0.87em; word-break: break-word; background-color: rgb(255, 245, 245); border-radius: 2px; overflow-x: auto; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 80, 44); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">subscribe()</span><span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">方法</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#000000" style="font-size: 9pt;">private void subscribe(Object subscriber, SubscriberMethod subscriberMethod) {</font></div><div><font color="#000000" style="font-size: 9pt;">    Class&lt;?&gt; eventType = subscriberMethod.eventType;</font></div><div><font color="#000000" style="font-size: 9pt;">    // 创建Subscription封装订阅者和订阅方法信息</font></div><div><font color="#000000" style="font-size: 9pt;">    Subscription newSubscription = new Subscription(subscriber, subscriberMethod);</font></div><div><font color="#000000" style="font-size: 9pt;">    // 根据事件类型从subscriptionsByEventType这个Map中获取Subscription集合</font></div><div><font color="#000000" style="font-size: 9pt;">    CopyOnWriteArrayList&lt;Subscription&gt; subscriptions = subscriptionsByEventType.get(eventType);</font></div><div><font color="#000000" style="font-size: 9pt;">    // 若Subscription集合为空，创建并put进Map中</font></div><div><font color="#000000" style="font-size: 9pt;">    if (subscriptions == null) {</font></div><div><font color="#000000" style="font-size: 9pt;">        subscriptions = new CopyOnWriteArrayList&lt;&gt;();</font></div><div><font color="#000000" style="font-size: 9pt;">        subscriptionsByEventType.put(eventType, subscriptions);</font></div><div><font color="#000000" style="font-size: 9pt;">    } else {</font></div><div><font color="#000000" style="font-size: 9pt;">        // 若集合中已包含该Subscription则抛异常</font></div><div><font color="#000000" style="font-size: 9pt;">        if (subscriptions.contains(newSubscription)) {</font></div><div><font color="#000000" style="font-size: 9pt;">            throw new EventBusException(&quot;Subscriber &quot; + subscriber.getClass() + &quot; already registered to event &quot;</font></div><div><font color="#000000" style="font-size: 9pt;">                    + eventType);</font></div><div><font color="#000000" style="font-size: 9pt;">        }</font></div><div><font color="#000000" style="font-size: 9pt;">    }</font></div><div><br/></div><div><font color="#000000" style="font-size: 9pt;">    int size = subscriptions.size();</font></div><div><font color="#000000" style="font-size: 9pt;">    for (int i = 0; i &lt;= size; i++) {</font></div><div><font color="#000000" style="font-size: 9pt;">        // 按照优先级插入Subscription</font></div><div><font color="#000000" style="font-size: 9pt;">        if (i == size || subscriberMethod.priority &gt; subscriptions.get(i).subscriberMethod.priority) {</font></div><div><font color="#000000" style="font-size: 9pt;">            subscriptions.add(i, newSubscription);</font></div><div><font color="#000000" style="font-size: 9pt;">            break;</font></div><div><font color="#000000" style="font-size: 9pt;">        }</font></div><div><font color="#000000" style="font-size: 9pt;">    }</font></div><div><br/></div><div><font color="#000000" style="font-size: 9pt;">    List&lt;Class&lt;?&gt;&gt; subscribedEvents = typesBySubscriber.get(subscriber);</font></div><div><font color="#000000" style="font-size: 9pt;">    if (subscribedEvents == null) {</font></div><div><font color="#000000" style="font-size: 9pt;">        subscribedEvents = new ArrayList&lt;&gt;();</font></div><div><font color="#000000" style="font-size: 9pt;">        typesBySubscriber.put(subscriber, subscribedEvents);</font></div><div><font color="#000000" style="font-size: 9pt;">    }</font></div><div><font color="#000000" style="font-size: 9pt;">    subscribedEvents.add(eventType);</font></div><div><font color="#000000" style="font-size: 9pt;">    // 订阅方法是否设置黏性模式</font></div><div><font color="#000000" style="font-size: 9pt;">    if (subscriberMethod.sticky) {</font></div><div><font color="#000000" style="font-size: 9pt;">        // 是否设置了事件继承</font></div><div><font color="#000000" style="font-size: 9pt;">        if (eventInheritance) {</font></div><div><font color="#000000" style="font-size: 9pt;">            // Existing sticky events of all subclasses of eventType have to be considered.</font></div><div><font color="#000000" style="font-size: 9pt;">            // Note: Iterating over all events may be inefficient with lots of sticky events,</font></div><div><font color="#000000" style="font-size: 9pt;">            // thus data structure should be changed to allow a more efficient lookup</font></div><div><font color="#000000" style="font-size: 9pt;">            // (e.g. an additional map storing sub classes of super classes: Class -&gt; List&lt;Class&gt;).</font></div><div><font color="#000000" style="font-size: 9pt;">            Set&lt;Map.Entry&lt;Class&lt;?&gt;, Object&gt;&gt; entries = stickyEvents.entrySet();</font></div><div><font color="#000000" style="font-size: 9pt;">            for (Map.Entry&lt;Class&lt;?&gt;, Object&gt; entry : entries) {</font></div><div><font color="#000000" style="font-size: 9pt;">                Class&lt;?&gt; candidateEventType = entry.getKey();</font></div><div><font color="#000000" style="font-size: 9pt;">                // 判断当前事件类型是否为黏性事件或者其子类</font></div><div><font color="#000000" style="font-size: 9pt;">                if (eventType.isAssignableFrom(candidateEventType)) {</font></div><div><font color="#000000" style="font-size: 9pt;">                    Object stickyEvent = entry.getValue();</font></div><div><font color="#000000" style="font-size: 9pt;">                    // 执行设置了sticky模式的订阅方法</font></div><div><font color="#000000" style="font-size: 9pt;">                    checkPostStickyEventToSubscription(newSubscription, stickyEvent);</font></div><div><font color="#000000" style="font-size: 9pt;">                }</font></div><div><font color="#000000" style="font-size: 9pt;">            }</font></div><div><font color="#000000" style="font-size: 9pt;">        } else {</font></div><div><font color="#000000" style="font-size: 9pt;">            Object stickyEvent = stickyEvents.get(eventType);</font></div><div><font color="#000000" style="font-size: 9pt;">            checkPostStickyEventToSubscription(newSubscription, stickyEvent);</font></div><div><font color="#000000" style="font-size: 9pt;">        }</font></div><div><font color="#000000" style="font-size: 9pt;">    }</font></div><div><font color="#000000" style="font-size: 9pt;">}</font></div></div><div><br/></div><div><span style="font-size: 11pt;">这就是注册的核心流程，所以subscribe()方法主要是得到了subscriptionsByEventType、typesBySubscriber两个 HashMap。我们在发送事件的时候要用到subscriptionsByEventType，完成事件的处理。当取消 EventBus 注册的时候要用到typesBySubscriber、subscriptionsByEventType，完成相关资源的释放</span></div><div><br/></div><div><span style="font-size: 14pt;">四 取消注册</span></div><div><span style="border: 0px; font-size: 13px; outline: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255); color: rgb(0, 111, 224); font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">   </span><span style="border: 0px; font-size: 13px; outline: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255); color: rgb(0, 45, 122); font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">EventBus</span><span style="border: 0px; font-size: 13px; outline: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255); color: rgb(51, 51, 51); font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="border: 0px; font-size: 13px; outline: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255); color: teal; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">getDefault</span><span style="border: 0px; font-size: 13px; outline: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255); color: rgb(51, 51, 51); font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">(</span><span style="border: 0px; font-size: 13px; outline: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255); color: rgb(51, 51, 51); font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">)</span><span style="border: 0px; font-size: 13px; outline: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255); color: rgb(51, 51, 51); font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="border: 0px; font-size: 13px; outline: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255); color: teal; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">unregister</span><span style="border: 0px; font-size: 13px; outline: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255); color: rgb(51, 51, 51); font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">(</span><span style="border: 0px; font-size: 13px; outline: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255); color: rgb(0, 0, 0); font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">this</span><span style="border: 0px; font-size: 13px; outline: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255); color: rgb(51, 51, 51); font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">)</span><span style="border: 0px; font-size: 13px; outline: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255); color: rgb(51, 51, 51); font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">;</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Consolas;"><font style="color: rgb(0, 0, 0);">public synchronized void unregister(Object subscriber) {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000">    //得到事件</font></span></div><div><span style="font-family: Consolas;"><font color="#000000">    List&lt;Class&lt;?&gt;&gt; subscribedTypes = typesBySubscriber.get(subscriber);</font></span></div><div><span style="font-family: Consolas;"><font color="#000000">    if (subscribedTypes != null) {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000">        for (Class&lt;?&gt; eventType : subscribedTypes) {</font></span></div><div><span style="font-family: Consolas;"><font style="color: rgb(0, 0, 0);">         </font><font color="#FF0000">   unsubscribeByEventType(subscriber, eventType);</font></span></div><div><span style="font-family: Consolas;"><font color="#000000">        }</font></span></div><div><span style="font-family: Consolas;"><font color="#000000">        typesBySubscriber.remove(subscriber);</font></span></div><div><span style="font-family: Consolas;"><font color="#000000">    } else {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000">        logger.log(Level.WARNING, &quot;Subscriber to unregister was not registered before: &quot; + subscriber.getClass());</font></span></div><div><span style="font-family: Consolas;"><font color="#000000">    }</font></span></div><div><span style="font-family: Consolas;"><font color="#000000">}</font></span></div></div><div>先根据<span style="color: rgb(0, 0, 0); font-family: Consolas;">subscriber 从缓存读取，不为null ，执行 <span style="color: rgb(0, 0, 0); font-family: Consolas;">unsubscribeByEventType（）方法</span></span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">/**</span></div><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">* Only updates subscriptionsByEventType, not typesBySubscriber! Caller must update typesBySubscriber.</span></div><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">*</span></div><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">* subscriptionsByEventType是存储事件类型对应订阅信息的Map，代码逻辑非常清晰，找出某事件类型的订阅信息List，遍历订阅信息，</span></div><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">* 将要取消订阅的订阅者和订阅信息封装的订阅者比对，如果是同一个，则说明该订阅信息是将要失效的，于是将该订阅信息移除</span></div><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">*</span></div><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">*/</span></div><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">private void unsubscribeByEventType(Object subscriber, Class&lt;?&gt; eventType) {</span></div><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">    //得到事件</span></div><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">    List&lt;Subscription&gt; subscriptions = subscriptionsByEventType.get(eventType);</span></div><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">    if (subscriptions != null) {</span></div><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">        int size = subscriptions.size();</span></div><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">        //循环遍历  集合，判断当前事件是否与取消的事件相等</span></div><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">        for (int i = 0; i &lt; size; i++) {</span></div><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">            Subscription subscription = subscriptions.get(i);</span></div><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">            if (subscription.subscriber == subscriber) {</span></div><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">                subscription.active = false;</span></div><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">                subscriptions.remove(i);</span></div><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">                i--;</span></div><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">                size--;</span></div><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">            }</span></div><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">        }</span></div><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">    }</span></div><div><span style="font-family: Consolas; color: rgb(98, 151, 85);">}</span></div></div><div><br/></div><div><span style="font-size: 14pt; font-family: Consolas;">五发送事件</span></div><div><span style="font-size: 9pt; font-family: Consolas;">EventBus.getDefault().</span><span style="font-size: 9pt; color: rgb(255, 0, 0); font-family: Consolas;">post</span><span style="font-size: 9pt; font-family: Consolas;">(new MessageEvent(&quot;Hello everyone!&quot;));</span></div><div><br/></div><div><span style="font-size: 11pt; font-family: Consolas;">发送事件主要通过post()方法</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">public void post(Object event) {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    // 获取当前线程的posting状态</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    PostingThreadState postingState = currentPostingThreadState.get();</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    List&lt;Object&gt; eventQueue = postingState.eventQueue;</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    // 将事件添加进当前线程的事件队列</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    eventQueue.add(event);</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    // 判断当前线程是否正在发布事件</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    if (!postingState.isPosting) {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        //判断当前线程是否是主线程</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        postingState.isMainThread = isMainThread();</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        //设置当前线程正在发布事件</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        postingState.isPosting = true;</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        //判断当前线程是否取消发布</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        if (postingState.canceled) {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">            throw new EventBusException(&quot;Internal error. Abort state was not reset&quot;);</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        }</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        try {</font></span></div><div><span style="font-size: 9pt; font-family: Consolas;">           //遍历事件</span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">            while (!eventQueue.isEmpty()) {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">           //发送单个事件</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">           //<span style="font-family: Consolas; color: #000000; font-size: 9pt;">eventQueue.remove(0) 从事件队列中移除</span></font></span></div><div><span style="font-family: Consolas;"><font style="font-size: 9pt; color: rgb(0, 0, 0);">       </font> <font color="#FF0000" style="font-size: 9pt;">    postSingleEvent(eventQueue.remove(0), postingState);</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">            }</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        } finally {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">            postingState.isPosting = false;</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">            postingState.isMainThread = false;</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        }</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    }</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">}</font></span></div></div><div><br/></div><div><span style="font-size: 11pt; font-family: Consolas;">循环出队列，执行</span><span style="font-size: 11pt; font-family: Consolas;">postSingleEvent（）方法</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Consolas;"><font style="font-size: 9pt; color: rgb(0, 0, 0);">private void postSingleEvent(Object event, PostingThreadState postingState) throws Error {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    //得到事件类型</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    Class&lt;?&gt; eventClass = event.getClass();</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    //是否找打事件发布</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    boolean subscriptionFound = false;</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    //是否是继承  若是，找出发布事件的所有父类</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    if (eventInheritance) {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        //找到所有的父类 在循环遍历</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        List&lt;Class&lt;?&gt;&gt; eventTypes = lookupAllEventTypes(eventClass);</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        int countTypes = eventTypes.size();</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        for (int h = 0; h &lt; countTypes; h++) {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">            Class&lt;?&gt; clazz = eventTypes.get(h);</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">            subscriptionFound |=</font> <font color="#FF0000" style="font-size: 9pt;">postSingleEventForEventType(event, postingState, clazz);</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        }</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    } else {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        //不是继承，  直接发布事件</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        subscriptionFound = postSingleEventForEventType(event, postingState, eventClass);</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    }</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    //没有找到事件 发布，发布一个 NoSubscriberEvent事件</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    if (!subscriptionFound) {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        if (logNoSubscriberMessages) {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">            logger.log(Level.FINE, &quot;No subscribers registered for event &quot; + eventClass);</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        }</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        if (sendNoSubscriberEvent &amp;&amp; eventClass != NoSubscriberEvent.class &amp;&amp;</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">                eventClass != SubscriberExceptionEvent.class) {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">            post(new NoSubscriberEvent(this, event));</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        }</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    }</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">}</font></span></div></div><div><br/></div><div><span style="font-size: 0.87em; word-break: break-word; background-color: rgb(255, 245, 245); border-radius: 2px; overflow-x: auto; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 80, 44); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">postSingleEvent()</span><span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">方法中，根据</span><span style="font-size: 0.87em; word-break: break-word; background-color: rgb(255, 245, 245); border-radius: 2px; overflow-x: auto; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 80, 44); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">eventInheritance</span><span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">属性，决定是否向上遍历事件的父类型，然后用</span><span style="font-size: 0.87em; word-break: break-word; background-color: rgb(255, 245, 245); border-radius: 2px; overflow-x: auto; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 80, 44); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">postSingleEventForEventType()</span><span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">方法进一步处理事件：</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">private boolean postSingleEventForEventType(Object event, PostingThreadState postingState, Class&lt;?&gt; eventClass) {</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">    CopyOnWriteArrayList&lt;Subscription&gt; subscriptions;</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">    synchronized (this) {</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">        // 根据事件类型找出相关的订阅信息</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">        subscriptions = subscriptionsByEventType.get(eventClass);</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">    }</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">    if (subscriptions != null &amp;&amp; !subscriptions.isEmpty()) {</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">        for (Subscription subscription : subscriptions) {</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">            postingState.event = event;</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">            postingState.subscription = subscription;</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">            boolean aborted = false;</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">            try {</font></span></div><div><font style="font-size: 9pt;">              <font color="#FF0000">  postToSubscription(subscription, event, postingState.isMainThread);</font></font></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">                aborted = postingState.canceled;</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">            } finally {</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">                postingState.event = null;</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">                postingState.subscription = null;</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">                postingState.canceled = false;</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">            }</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">            if (aborted) {</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">                break;</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">            }</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">        }</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">        return true;</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">    }</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">    return false;</font></span></div><div style="color: rgb(51, 51, 51);"><span style="color: rgb(51, 51, 51);"><font style="font-size: 9pt;">}</font></span></div></div><div><br/></div><div><span style="font-size: 0.87em; word-break: break-word; background-color: rgb(255, 245, 245); border-radius: 2px; overflow-x: auto; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 80, 44); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">postSingleEvent()</span><span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">方法中，根据</span><span style="font-size: 0.87em; word-break: break-word; background-color: rgb(255, 245, 245); border-radius: 2px; overflow-x: auto; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 80, 44); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">eventInheritance</span><span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">属性，决定是否向上遍历事件的父类型，然后用</span><span style="font-size: 0.87em; word-break: break-word; background-color: rgb(255, 245, 245); border-radius: 2px; overflow-x: auto; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 80, 44); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">postSingleEventForEventType()</span><span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">方法进一步处理事件：</span></div><div><span style="font-size: 14pt; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif;">六 事件的处理</span><span style="font-size: 14pt; color: rgb(0, 0, 0); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif;">postToSubscription（）</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 9pt; color: rgb(0, 0, 0);">private void postToSubscription(Subscription subscription, Object event, boolean isMainThread) {</font></div><div><font color="#000000" style="font-size: 9pt;">    switch (subscription.subscriberMethod.threadMode) {</font></div><div><font color="#000000" style="font-size: 9pt;">        // 订阅线程跟随发布线程</font></div><div><font color="#000000" style="font-size: 9pt;">        case POSTING:</font></div><div><font color="#000000" style="font-size: 9pt;">            // 订阅线程和发布线程相同，直接订阅</font></div><div><font color="#000000" style="font-size: 9pt;">            invokeSubscriber(subscription, event);</font></div><div><font color="#000000" style="font-size: 9pt;">            break;</font></div><div><font color="#000000" style="font-size: 9pt;">        // 订阅线程为主线程</font></div><div><font color="#000000" style="font-size: 9pt;">        case MAIN:</font></div><div><font color="#000000" style="font-size: 9pt;">            if (isMainThread) {</font></div><div><font color="#000000" style="font-size: 9pt;">                // 发布线程和订阅线程都是主线程，直接订阅</font></div><div><font style="font-size: 9pt; color: rgb(0, 0, 0);">                invokeSubscriber(subscription, event);</font></div><div><font color="#000000" style="font-size: 9pt;">            } else {</font></div><div><font color="#000000" style="font-size: 9pt;">                // 发布线程不为主线程，通过线handler 进行转换后，发布</font></div><div><font color="#000000" style="font-size: 9pt;">                mainThreadPoster.enqueue(subscription, event);</font></div><div><font color="#000000" style="font-size: 9pt;">            }</font></div><div><font color="#000000" style="font-size: 9pt;">            break;</font></div><div><font color="#000000" style="font-size: 9pt;">        //订阅在主线程  有序的</font></div><div><font color="#000000" style="font-size: 9pt;">        case MAIN_ORDERED:</font></div><div><font color="#000000" style="font-size: 9pt;">            if (mainThreadPoster != null) {</font></div><div><font color="#000000" style="font-size: 9pt;">                mainThreadPoster.enqueue(subscription, event);</font></div><div><font color="#000000" style="font-size: 9pt;">            } else {</font></div><div><font color="#000000" style="font-size: 9pt;">                // temporary: technically not correct as poster not decoupled from subscriber</font></div><div><font color="#000000" style="font-size: 9pt;">                //暂时：技术上不正确，因为发布者与订阅者没有解耦</font></div><div><font color="#000000" style="font-size: 9pt;">                invokeSubscriber(subscription, event);</font></div><div><font color="#000000" style="font-size: 9pt;">            }</font></div><div><font color="#000000" style="font-size: 9pt;">            break;</font></div><div><font color="#000000" style="font-size: 9pt;">        // 订阅线程为后台线程</font></div><div><font color="#000000" style="font-size: 9pt;">        case BACKGROUND:</font></div><div><font color="#000000" style="font-size: 9pt;">            if (isMainThread) {</font></div><div><font color="#000000" style="font-size: 9pt;">                // 发布线程为主线程，通过线程池切换到后台线程订阅</font></div><div><font color="#000000" style="font-size: 9pt;">                backgroundPoster.enqueue(subscription, event);</font></div><div><font color="#000000" style="font-size: 9pt;">            } else {</font></div><div><font color="#000000" style="font-size: 9pt;">                // 发布线程不为主线程，直接订阅</font></div><div><font color="#000000" style="font-size: 9pt;">                invokeSubscriber(subscription, event);</font></div><div><font color="#000000" style="font-size: 9pt;">            }</font></div><div><font color="#000000" style="font-size: 9pt;">            break;</font></div><div><font color="#000000" style="font-size: 9pt;">        // 订阅线程为异步线程</font></div><div><font color="#000000" style="font-size: 9pt;">        case ASYNC:</font></div><div><font color="#000000" style="font-size: 9pt;">            // 使用线程池线程订阅 例如线程池</font></div><div><font color="#000000" style="font-size: 9pt;">            asyncPoster.enqueue(subscription, event);</font></div><div><font color="#000000" style="font-size: 9pt;">            break;</font></div><div><font color="#000000" style="font-size: 9pt;">        default:</font></div><div><font color="#000000" style="font-size: 9pt;">            throw new IllegalStateException(&quot;Unknown thread mode: &quot; + subscription.subscriberMethod.threadMode);</font></div><div><font color="#000000" style="font-size: 9pt;">    }</font></div><div><font color="#000000" style="font-size: 9pt;">}</font></div></div><div><br/></div><div><span style="font-size: 9pt; color: rgb(0, 0, 0);">一种是通过反射  invokeSubscriber（） <span style="font-size: 9pt; color: rgb(0, 0, 0);">主要是用反射</span></span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt; color: rgb(98, 151, 85);">/**</span></div><div><span style="font-size: 9pt; color: rgb(98, 151, 85);">* 通过反射，发布事件</span></div><div><span style="font-size: 9pt; color: rgb(98, 151, 85);">* @param subscription</span></div><div><span style="font-size: 9pt; color: rgb(98, 151, 85);">* @param event</span></div><div><span style="font-size: 9pt; color: rgb(98, 151, 85);">*/</span></div><div><span style="font-size: 9pt; color: rgb(98, 151, 85);">void invokeSubscriber(Subscription subscription, Object event) {</span></div><div><span style="font-size: 9pt; color: rgb(98, 151, 85);">    try {</span></div><div><span style="font-size: 9pt; color: rgb(98, 151, 85);">        subscription.subscriberMethod.method.invoke(subscription.subscriber, event);</span></div><div><span style="font-size: 9pt; color: rgb(98, 151, 85);">    } catch (InvocationTargetException e) {</span></div><div><span style="font-size: 9pt; color: rgb(98, 151, 85);">        handleSubscriberException(subscription, event, e.getCause());</span></div><div><span style="font-size: 9pt; color: rgb(98, 151, 85);">    } catch (IllegalAccessException e) {</span></div><div><span style="font-size: 9pt; color: rgb(98, 151, 85);">        throw new IllegalStateException(&quot;Unexpected exception&quot;, e);</span></div><div><span style="font-size: 9pt; color: rgb(98, 151, 85);">    }</span></div><div><span style="font-size: 9pt; color: rgb(98, 151, 85);">}</span></div></div><div><br/></div><div><span style="font-size: 11pt; font-family: 宋体;">一种是 通过handler 主要是实现 <span style="font-size: 13.05px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 245, 245); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; color: rgb(255, 80, 44); font-variant-caps: normal; font-variant-ligatures: normal;">HandlerPoster 这个类</span></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: 宋体; font-size: 11pt; color: rgb(152, 118, 170);">mainThreadPoster.enqueue(subscription, event);</span></div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#000000">public class HandlerPoster extends Handler implements Poster {</font></div><div><br/></div><div><font color="#000000">    private final PendingPostQueue queue;</font></div><div><font color="#000000">    private final int maxMillisInsideHandleMessage;</font></div><div><font color="#000000">    private final EventBus eventBus;</font></div><div><font color="#000000">    private boolean handlerActive;</font></div><div><br/></div><div><font color="#000000">    protected HandlerPoster(EventBus eventBus, Looper looper, int maxMillisInsideHandleMessage) {</font></div><div><font color="#000000">        super(looper);</font></div><div><font color="#000000">        this.eventBus = eventBus;</font></div><div><font color="#000000">        this.maxMillisInsideHandleMessage = maxMillisInsideHandleMessage;</font></div><div><font color="#000000">        queue = new PendingPostQueue();</font></div><div><font color="#000000">    }</font></div><div><br/></div><div><font color="#000000">    public void enqueue(Subscription subscription, Object event) {</font></div><div><font color="#000000">        // 用subscription和event封装一个PendingPost对象</font></div><div><font color="#000000">        PendingPost pendingPost = PendingPost.obtainPendingPost(subscription, event);</font></div><div><font color="#000000">        synchronized (this) {</font></div><div><font color="#000000">            // 入队列</font></div><div><font color="#000000">            queue.enqueue(pendingPost);</font></div><div><font color="#000000">            if (!handlerActive) {</font></div><div><font color="#000000">                handlerActive = true;</font></div><div><font color="#000000">                // 发送开始处理事件的消息，handleMessage()方法将被执行，完成从子线程到主线程的切换</font></div><div><font color="#000000">                if (!sendMessage(obtainMessage())) {</font></div><div><font color="#000000">                    throw new EventBusException(&quot;Could not send handler message&quot;);</font></div><div><font color="#000000">                }</font></div><div><font color="#000000">            }</font></div><div><font color="#000000">        }</font></div><div><font color="#000000">    }</font></div><div><br/></div><div><font color="#000000">    @Override</font></div><div><font color="#000000">    public void handleMessage(Message msg) {</font></div><div><font color="#000000">        boolean rescheduled = false;</font></div><div><font color="#000000">        try {</font></div><div><font color="#000000">            long started = SystemClock.uptimeMillis();</font></div><div><font color="#000000">            // 死循环遍历队列</font></div><div><font color="#000000">            while (true) {</font></div><div><font color="#000000">                // 出队列</font></div><div><font color="#000000">                PendingPost pendingPost = queue.poll();</font></div><div><font color="#000000">                if (pendingPost == null) {</font></div><div><font color="#000000">                    synchronized (this) {</font></div><div><font color="#000000">                        // Check again, this time in synchronized</font></div><div><font color="#000000">                        pendingPost = queue.poll();</font></div><div><font color="#000000">                        if (pendingPost == null) {</font></div><div><font color="#000000">                            handlerActive = false;</font></div><div><font color="#000000">                            return;</font></div><div><font color="#000000">                        }</font></div><div><font color="#000000">                    }</font></div><div><font color="#000000">                }</font></div><div><font color="#000000">                // 进一步处理pendingPost</font></div><div><font color="#000000">               </font><font color="#FF0000"> eventBus.invokeSubscriber(pendingPost);</font></div><div><font color="#000000">                long timeInMethod = SystemClock.uptimeMillis() - started;</font></div><div><font color="#000000">                if (timeInMethod &gt;= maxMillisInsideHandleMessage) {</font></div><div><font color="#000000">                    if (!sendMessage(obtainMessage())) {</font></div><div><font color="#000000">                        throw new EventBusException(&quot;Could not send handler message&quot;);</font></div><div><font color="#000000">                    }</font></div><div><font color="#000000">                    rescheduled = true;</font></div><div><font color="#000000">                    return;</font></div><div><font color="#000000">                }</font></div><div><font color="#000000">            }</font></div><div><font color="#000000">        } finally {</font></div><div><font color="#000000">            handlerActive = rescheduled;</font></div><div><font color="#000000">        }</font></div><div><font color="#000000">    }</font></div><div><font color="#000000">}</font></div></div><div>所以HandlerPoster的enqueue()方法主要就是将subscription、event对象封装成一个PendingPost对象，然后保存到队列里，之后通过Handler切换到主线程，在handleMessage()方法将中将PendingPost对象循环出队列，交给invokeSubscriber()方法进一步处理：</div><div><br style="color: rgb(204, 120, 50);"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#000000">void invokeSubscriber(PendingPost pendingPost) {</font></div><div><font color="#000000">    Object event = pendingPost.event;</font></div><div><font color="#000000">    // 释放pendingPost引用的资源</font></div><div><font color="#000000">    Subscription subscription = pendingPost.subscription;</font></div><div><font color="#000000">    PendingPost.releasePendingPost(pendingPost);</font></div><div><font color="#000000">    if (subscription.active) {</font></div><div><font color="#000000">        // 用反射来执行订阅事件的方法</font></div><div><font color="#000000">        invokeSubscriber(subscription, event);</font></div><div><font color="#000000">    }</font></div><div><font color="#000000">}</font></div></div><div><br/></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt;-en-paragraph:true;">这个方法很简单，主要就是从</span><span style="font-size: 12pt;-en-paragraph:true;">pendingPost</span><span style="font-size: 12pt;-en-paragraph:true;">中取出之前保存的</span><span style="font-size: 12pt;-en-paragraph:true;">event</span><span style="font-size: 12pt;-en-paragraph:true;">、</span><span style="font-size: 12pt;-en-paragraph:true;">subscription</span><span style="font-size: 12pt;-en-paragraph:true;">，然后用反射来执行订阅事件的方法，又回到了第一种处理方式。所以</span><span style="font-size: 12pt;-en-paragraph:true;">mainThreadPoster.enqueue(subscription, event)</span><span style="font-size: 12pt;-en-paragraph:true;">的核心就是先将将事件入队列，然后通过Handler从子线程切换到主线程中去处理事件。</span></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><font style="font-size: 12pt;"><span style="font-size: 12pt;-en-paragraph:true;">backgroundPoster.enqueue()</span><span style="font-size: 12pt;-en-paragraph:true;">和</span><span style="font-size: 12pt;-en-paragraph:true;">asyncPoster.enqueue</span><span style="font-size: 12pt;-en-paragraph:true;">也类似，内部都是先将事件入队列，然后再出队列，但是会通过线程池去进一步处理事件</span></font></div><div style="margin-top: 1em; margin-bottom: 1em;"></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16px;">七 粘性事件</span></div><div><span style="font-size: 11px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 248); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">EventBus.getDefault().postSticky(</span><span style="font-size: 11px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">&quot;Hello World!&quot;</span><span style="font-size: 11px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 248); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">);</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#000000" face="Candara" style="font-size: 9pt;">public void postSticky(Object event) {</font></div><div><font color="#000000" face="Candara" style="font-size: 9pt;">    synchronized (stickyEvents) {</font></div><div><font color="#000000" face="Candara" style="font-size: 9pt;">        stickyEvents.put(event.getClass(), event);</font></div><div><font color="#000000" face="Candara" style="font-size: 9pt;">    }</font></div><div><font color="#000000" face="Candara" style="font-size: 9pt;">    // Should be posted after it is putted, in case the subscriber wants to remove immediately</font></div><div><font color="#000000" face="Candara" style="font-size: 9pt;">    post(event);</font></div><div><font color="#000000" face="Candara" style="font-size: 9pt;">}</font></div></div><div><span style="font-size: 12pt; font-family: Consolas;">postSticky()方法主要做了两件事，先将事件类型和对应事件保存到stickyEvents中，方便后续使用；然后执行post(event)继续发送事件，这个post()方法就是之前发送的post()方法。所以，如果在发送粘性事件前，已经有了对应类型事件的订阅者，及时它是非粘性的，依然可以接收到发送出的粘性事件</span></div><div><br/></div><div><font face="Consolas" style="font-size: 12pt;"><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 12pt; font-family: Consolas; color: rgb(51, 51, 51); font-variant-caps: normal; font-variant-ligatures: normal;">发送完粘性事件后，再准备订阅粘性事件的方法，并完成注册。核心的注册事件流程还是我们之前的</span><span style="word-break: break-word; background-color: rgb(255, 245, 245); border-radius: 2px; overflow-x: auto; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 12pt; font-family: Consolas; color: rgb(255, 80, 44); font-variant-caps: normal; font-variant-ligatures: normal;">register()</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 12pt; font-family: Consolas; color: rgb(51, 51, 51); font-variant-caps: normal; font-variant-ligatures: normal;">方法中的</span><span style="word-break: break-word; background-color: rgb(255, 245, 245); border-radius: 2px; overflow-x: auto; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 12pt; font-family: Consolas; color: rgb(255, 80, 44); font-variant-caps: normal; font-variant-ligatures: normal;">subscribe()</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 12pt; font-family: Consolas; color: rgb(51, 51, 51); font-variant-caps: normal; font-variant-ligatures: normal;">方法，前边分析</span><span style="word-break: break-word; background-color: rgb(255, 245, 245); border-radius: 2px; overflow-x: auto; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 12pt; font-family: Consolas; color: rgb(255, 80, 44); font-variant-caps: normal; font-variant-ligatures: normal;">subscribe()</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 12pt; font-family: Consolas; color: rgb(51, 51, 51); font-variant-caps: normal; font-variant-ligatures: normal;">方法时，有一段没有分析的代码，就是用来处理粘性事件的：</span></font></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">private void subscribe(Object subscriber, SubscriberMethod subscriberMethod) {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    Class&lt;?&gt; eventType = subscriberMethod.eventType;</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    // 创建Subscription封装订阅者和订阅方法信息</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    Subscription newSubscription = new Subscription(subscriber, subscriberMethod);</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    // 根据事件类型从subscriptionsByEventType这个Map中获取Subscription集合</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    CopyOnWriteArrayList&lt;Subscription&gt; subscriptions = subscriptionsByEventType.get(eventType);</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    // 若Subscription集合为空，创建并put进Map中</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    if (subscriptions == null) {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        subscriptions = new CopyOnWriteArrayList&lt;&gt;();</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        subscriptionsByEventType.put(eventType, subscriptions);</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    } else {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        // 若集合中已包含该Subscription则抛异常</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        if (subscriptions.contains(newSubscription)) {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">            throw new EventBusException(&quot;Subscriber &quot; + subscriber.getClass() + &quot; already registered to event &quot;</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">                    + eventType);</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        }</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    }</font></span></div><div><br style="font-family: Consolas;"/></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    int size = subscriptions.size();</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    for (int i = 0; i &lt;= size; i++) {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        // 按照优先级插入Subscription</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        if (i == size || subscriberMethod.priority &gt; subscriptions.get(i).subscriberMethod.priority) {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">            subscriptions.add(i, newSubscription);</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">            break;</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        }</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    }</font></span></div><div><br style="font-family: Consolas;"/></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    List&lt;Class&lt;?&gt;&gt; subscribedEvents = typesBySubscriber.get(subscriber);</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    if (subscribedEvents == null) {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        subscribedEvents = new ArrayList&lt;&gt;();</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        typesBySubscriber.put(subscriber, subscribedEvents);</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    }</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    subscribedEvents.add(eventType);</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    // 订阅方法是否设置黏性模式</font></span></div><div><span style="font-family: Consolas;"><font color="#FF0000" style="font-size: 9pt;">    if (subscriberMethod.sticky) {</font></span></div><div><span style="font-family: Consolas;"><font color="#FF0000" style="font-size: 9pt;">        // 是否设置了事件继承</font></span></div><div><span style="font-family: Consolas;"><font color="#FF0000" style="font-size: 9pt;">        if (eventInheritance) {</font></span></div><div><span style="font-family: Consolas;"><font color="#FF0000" style="font-size: 9pt;">            // Existing sticky events of all subclasses of eventType have to be considered.</font></span></div><div><span style="font-family: Consolas;"><font color="#FF0000" style="font-size: 9pt;">            // Note: Iterating over all events may be inefficient with lots of sticky events,</font></span></div><div><span style="font-family: Consolas;"><font color="#FF0000" style="font-size: 9pt;">            // thus data structure should be changed to allow a more efficient lookup</font></span></div><div><span style="font-family: Consolas;"><font color="#FF0000" style="font-size: 9pt;">            // (e.g. an additional map storing sub classes of super classes: Class -&gt; List&lt;Class&gt;).</font></span></div><div><span style="font-family: Consolas;"><font color="#FF0000" style="font-size: 9pt;">            Set&lt;Map.Entry&lt;Class&lt;?&gt;, Object&gt;&gt; entries = stickyEvents.entrySet();</font></span></div><div><span style="font-family: Consolas;"><font color="#FF0000" style="font-size: 9pt;">            for (Map.Entry&lt;Class&lt;?&gt;, Object&gt; entry : entries) {</font></span></div><div><span style="font-family: Consolas;"><font color="#FF0000" style="font-size: 9pt;">                Class&lt;?&gt; candidateEventType = entry.getKey();</font></span></div><div><span style="font-family: Consolas;"><font color="#FF0000" style="font-size: 9pt;">                // 判断当前事件类型是否为黏性事件或者其子类</font></span></div><div><span style="font-family: Consolas;"><font color="#FF0000" style="font-size: 9pt;">                if (eventType.isAssignableFrom(candidateEventType)) {</font></span></div><div><span style="font-family: Consolas;"><font color="#FF0000" style="font-size: 9pt;">                    Object stickyEvent = entry.getValue();</font></span></div><div><span style="font-family: Consolas;"><font color="#FF0000" style="font-size: 9pt;">                    // 执行设置了sticky模式的订阅方法</font></span></div><div><span style="font-family: Consolas;"><font color="#FF0000" style="font-size: 9pt;">                    checkPostStickyEventToSubscription(newSubscription, stickyEvent);</font></span></div><div><span style="font-family: Consolas;"><font color="#FF0000" style="font-size: 9pt;">                }</font></span></div><div><span style="font-family: Consolas;"><font color="#FF0000" style="font-size: 9pt;">            }</font></span></div><div><span style="font-family: Consolas;"><font color="#FF0000" style="font-size: 9pt;">        } else {</font></span></div><div><span style="font-family: Consolas;"><font color="#FF0000" style="font-size: 9pt;">            Object stickyEvent = stickyEvents.get(eventType);</font></span></div><div><span style="font-family: Consolas;"><font color="#FF0000" style="font-size: 9pt;">            checkPostStickyEventToSubscription(newSubscription, stickyEvent);</font></span></div><div><span style="font-family: Consolas;"><font color="#FF0000" style="font-size: 9pt;">        }</font></span></div><div><span style="font-family: Consolas;"><font color="#FF0000" style="font-size: 9pt;">    }</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">}</font></span></div></div><div><span style="font-size: 16px; font-family: Consolas;">红色部分是粘性事件的处理</span></div><div><span style="font-size: 12pt; font-family: Consolas;">可以看到，处理粘性事件就是在 EventBus 注册时，遍历stickyEvents，如果当前要注册的事件订阅方法是粘性的，并且该方法接收的事件类型和stickyEvents中某个事件类型相同或者是其父类，则取出stickyEvents中对应事件类型的具体事件，做进一步处理。继续看checkPostStickyEventToSubscription()处理方法</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">private void checkPostStickyEventToSubscription(Subscription newSubscription, Object stickyEvent) {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    if (stickyEvent != null) {</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        // If the subscriber is trying to abort the event, it will fail (event is not tracked in posting state)</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        // --&gt; Strange corner case, which we don't take care of here.</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">        postToSubscription(newSubscription, stickyEvent, isMainThread());</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">    }</font></span></div><div><span style="font-family: Consolas;"><font color="#000000" style="font-size: 9pt;">}</font></span></div></div><div><br/></div><div><span style="font-size: 16px; font-family: Consolas;">regiser</span></div><div><a href="https://user-gold-cdn.xitu.io/2018/4/27/1630655a5f017123?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">https://user-gold-cdn.xitu.io/2018/4/27/1630655a5f017123?imageView2/0/w/1280/h/960/format/webp/ignore-error/1</a></div><div><img src="https://user-gold-cdn.xitu.io/2018/4/27/1630655a5f017123?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" style="font-family: Consolas; font-size: 12pt;"></img></div><div>post</div><div><a href="https://user-gold-cdn.xitu.io/2018/4/27/1630655a5f12b2d7?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">https://user-gold-cdn.xitu.io/2018/4/27/1630655a5f12b2d7?imageView2/0/w/1280/h/960/format/webp/ignore-error/1</a></div><div><br/></div><div><img src="https://user-gold-cdn.xitu.io/2018/4/27/1630655a5f12b2d7?imageView2/0/w/1280/h/960/format/webp/ignore-error/1"></img></div><div><span style="border: 0px; font-size: 13px; outline: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 255); color: teal; font-family: Consolas, ConsolasRegular, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">unregister</span></div><div><a href="https://user-gold-cdn.xitu.io/2018/4/27/1630655a5f7e683b?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" style="font-family: Consolas; color: rgb(0, 128, 128);">https://user-gold-cdn.xitu.io/2018/4/27/1630655a5f7e683b?imageView2/0/w/1280/h/960/format/webp/ignore-error/1</a></div><div><img src="https://user-gold-cdn.xitu.io/2018/4/27/1630655a5f7e683b?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" style="font-family: Consolas; color: rgb(0, 128, 128);"></img></div><div><br/></div></span>
</div></body></html> 